<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.scott.modelcontext.monitoring.model">

<!--  assoc mapping to subsyntax -->
<resultMap type="IXMLSyntaxModel" id="IXMLSubSyntaxModelMap">
	<constructor>
		<idArg javaType="Long" column="XMP_SUB_SYNTAX_ID" jdbcType="BIGINT"/>
	</constructor>
</resultMap>

<!--  assoc mapping back to syntax -->
<resultMap type="IXMLSyntaxModel" id="IXMLSyntaxModelID">
	<constructor>
		<idArg javaType="Long" column="SM_ID" jdbcType="BIGINT"/>
	</constructor>
</resultMap>
<resultMap type="IXMLSyntaxModel" id="IXMLSyntaxModelMap">
	<constructor>
		<idArg javaType="Long" column="SM_ID" jdbcType="BIGINT"/>
	</constructor>
  <result property="name" column="SM_NAME" jdbcType="VARCHAR"/>
  <association property="user" resultMap="IUserIDMap"/>
  <collection property="mappings" javaType="java.util.ArrayList" ofType="IXMLMapping" resultMap="IXMLMappingIDMap"/>
</resultMap>

<resultMap type="IXMLMapping" id="IXMLMappingIDMap">
	<constructor>
		<idArg javaType="Long" column="XMP_ID" jdbcType="BIGINT"/>
	</constructor>
</resultMap>
<resultMap type="IXMLMapping" id="IXMLMappingMap">
	<constructor>
		<idArg javaType="Long" column="XMP_ID" jdbcType="BIGINT"/>
	</constructor>
  <result property="xpath" column="XMP_XPATH" jdbcType="VARCHAR"/>
  <result property="targetFieldName" column="XMP_TARGET_FIELD_NAME" jdbcType="VARCHAR"/>
  <association property="syntaxModel"   resultMap="IXMLSyntaxModelID"/>
  <association property="subSyntaxModel" resultMap="IXMLSubSyntaxModelMap"/>
</resultMap>

<resultMap type="IUser" id="IUserIDMap">
	<constructor>
		<idArg javaType="Long" column="US_ID" jdbcType="BIGINT"/>
	</constructor>
</resultMap>

<resultMap type="IUser" id="IUserMap">
	<constructor>
		<idArg javaType="Long" column="US_ID" jdbcType="BIGINT"/>
	</constructor>
  <result property="name" column="US_USER_NAME" jdbcType="VARCHAR"/>
</resultMap>

 <select id="IXMLSyntaxModel_load" resultMap="IXMLSyntaxModelMap">
   select 	sm.ID "SM_ID", 
   			sm.NAME "SM_NAME",
   			xmp.ID "XMP_ID",
   			us.ID "US_ID"
   from SS_SYNTAX_MODEL sm, SS_XML_MAPPING xmp, SS_USER us
   <where>
     xmp.SYNTAX_MODEL_ID = sm.ID and us.ID = sm.USER_ID
     <if test="id != null">
       AND sm.ID = #{id}
     </if>
   </where>
 </select>

 <select id="IXMLMapping_load" resultMap="IXMLMappingMap">
   select 	xmp.ID "XMP_ID",
   			xmp.XPATH "XMP_XPATH",
   			xmp.TARGET_FIELD_NAME "XMP_TARGET_FIELD_NAME",
   			xmp.SYNTAX_MODEL_ID "SM_ID",
   			xmp.SUB_SYNTAX_ID "XMP_SUB_SYNTAX_ID"
   from SS_XML_MAPPING xmp
   <where>
     <if test="id != null">
       xmp.ID = #{id}
     </if>
   </where>
 </select>
 
 <select id="IUser_load" resultMap="IUserMap">
   select 	us.ID "US_ID",
   			us.USER_NAME "US_USER_NAME"
   from SS_USER us
   <where>
     <if test="id != null">
       us.ID = #{id}
     </if>
   </where> 
 </select>
 
</mapper>
